; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: %cheri_purecap_llc -o - -O2 -verify-machineinstrs %s | %cheri_FileCheck %s

; Function Attrs: nounwind
define i32 @load_store_stack_i32(i32 %arg, ptr addrspace(200) %padding) addrspace(200) #0 {
; CHECK-LABEL: load_store_stack_i32:
; CHECK:       # %bb.0:
; CHECK-NEXT:    cincoffset $c11, $c11, -16
; CHECK-NEXT:    #APP
; CHECK-NEXT:    #NO_APP
; CHECK-NEXT:    csw $4, $zero, 8($c11)
; CHECK-NEXT:    #APP
; CHECK-NEXT:    #NO_APP
; CHECK-NEXT:    clw $2, $zero, 8($c11)
; CHECK-NEXT:    #APP
; CHECK-NEXT:    #NO_APP
; CHECK-NEXT:    cjr $c17
; CHECK-NEXT:    cincoffset $c11, $c11, 16
  tail call void asm sideeffect "", ""()
  %arg.stack = alloca i32, align 8, addrspace(200)
  store volatile i32 %arg, ptr addrspace(200) %arg.stack, align 4
  tail call void asm sideeffect "", ""()
  %loaded = load volatile i32, ptr addrspace(200) %arg.stack, align 4
  tail call void asm sideeffect "", ""()
  ret i32 %loaded
}

; Function Attrs: nounwind
define i16 @load_store_stack_i16(i16 %arg, ptr addrspace(200) %padding) addrspace(200) #0 {
; CHECK-LABEL: load_store_stack_i16:
; CHECK:       # %bb.0:
; CHECK-NEXT:    cincoffset $c11, $c11, -16
; CHECK-NEXT:    #APP
; CHECK-NEXT:    #NO_APP
; CHECK-NEXT:    csh $4, $zero, 8($c11)
; CHECK-NEXT:    #APP
; CHECK-NEXT:    #NO_APP
; CHECK-NEXT:    clhu $2, $zero, 8($c11)
; CHECK-NEXT:    #APP
; CHECK-NEXT:    #NO_APP
; CHECK-NEXT:    cjr $c17
; CHECK-NEXT:    cincoffset $c11, $c11, 16
  tail call void asm sideeffect "", ""()
  %arg.stack = alloca i16, align 8, addrspace(200)
  store volatile i16 %arg, ptr addrspace(200) %arg.stack, align 4
  tail call void asm sideeffect "", ""()
  %loaded = load volatile i16, ptr addrspace(200) %arg.stack, align 4
  tail call void asm sideeffect "", ""()
  ret i16 %loaded
}

; Function Attrs: nounwind
define i1 @load_store_stack_i1(i1 %arg, ptr addrspace(200) %padding) addrspace(200) #0 {
; CHECK-LABEL: load_store_stack_i1:
; CHECK:       # %bb.0:
; CHECK-NEXT:    cincoffset $c11, $c11, -16
; CHECK-NEXT:    #APP
; CHECK-NEXT:    #NO_APP
; CHECK-NEXT:    andi $1, $4, 1
; CHECK-NEXT:    csb $1, $zero, 8($c11)
; CHECK-NEXT:    #APP
; CHECK-NEXT:    #NO_APP
; CHECK-NEXT:    clbu $2, $zero, 8($c11)
; CHECK-NEXT:    #APP
; CHECK-NEXT:    #NO_APP
; CHECK-NEXT:    cjr $c17
; CHECK-NEXT:    cincoffset $c11, $c11, 16
  tail call void asm sideeffect "", ""()
  %arg.stack = alloca i1, align 8, addrspace(200)
  store volatile i1 %arg, ptr addrspace(200) %arg.stack, align 4
  tail call void asm sideeffect "", ""()
  %loaded = load volatile i1, ptr addrspace(200) %arg.stack, align 4
  tail call void asm sideeffect "", ""()
  ret i1 %loaded
}

attributes #0 = { nounwind }
