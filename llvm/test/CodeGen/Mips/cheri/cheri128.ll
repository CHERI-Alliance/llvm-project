; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: %cheri128_llc -O2 -o - -relocation-model=pic %s | FileCheck %s

@array = common global [2 x ptr addrspace(200)] zeroinitializer, align 16

define ptr addrspace(200) @get(i32 signext %x) {
; CHECK-LABEL: get:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    lui $1, %hi(%neg(%gp_rel(get)))
; CHECK-NEXT:    daddu $1, $1, $25
; CHECK-NEXT:    daddiu $1, $1, %lo(%neg(%gp_rel(get)))
; CHECK-NEXT:    ld $1, %got_disp(array)($1)
; CHECK-NEXT:    dsll $2, $4, 4
; CHECK-NEXT:    daddu $1, $1, $2
; CHECK-NEXT:    clc $c3, $1, 0($ddc)
; CHECK-NEXT:    jr $ra
; CHECK-NEXT:    nop
entry:
  ; Check that we convert the index to an offset by multiplying by 16:
  %idxprom = sext i32 %x to i64
  %arrayidx = getelementptr inbounds [2 x ptr addrspace(200)], ptr @array, i64 0, i64 %idxprom
  %0 = load ptr addrspace(200), ptr %arrayidx, align 16
  ret ptr addrspace(200) %0
}
