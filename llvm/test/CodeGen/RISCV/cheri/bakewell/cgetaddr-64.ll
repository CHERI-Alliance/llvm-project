; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: %riscv64_bakewell_hybrid_llc -verify-machineinstrs < %s \
; RUN:   | FileCheck --check-prefix=RV64LEGACY %s


define i8* @foo(i8 addrspace(200)* %cap ) nounwind {
; RV64LEGACY-LABEL: foo:
; RV64LEGACY:       # %bb.0: # %entry
; RV64LEGACY-NEXT:    addi sp, sp, -16
; RV64LEGACY-NEXT:    mv a1, a0
; RV64LEGACY-NEXT:    sc ca0, 0(sp)
; RV64LEGACY-NEXT:    mv a0, a1
; RV64LEGACY-NEXT:    addi sp, sp, 16
; RV64LEGACY-NEXT:    ret
entry:
  %cap.addr = alloca i8 addrspace(200)*, align 16
  store i8 addrspace(200)* %cap, i8 addrspace(200)** %cap.addr, align 16
  %0 = load i8 addrspace(200)*, i8 addrspace(200)** %cap.addr, align 16
  %1 = call i64 @llvm.cheri.cap.address.get.i64(i8 addrspace(200)* %0)
  %2 = inttoptr i64 %1 to i8*
  ret i8* %2
}

; Function Attrs: nounwind readnone willreturn
declare i64 @llvm.cheri.cap.address.get.i64(i8 addrspace(200)*)
